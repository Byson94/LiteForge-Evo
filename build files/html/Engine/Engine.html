<!--
This file uses the library "Blocky" developed by Google
More details can be found on "LiteForge-Evo/Third-party libraries/Blocky LICENSE"
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiteForge Evo</title>
    <link rel="stylesheet" href="../../css/EngineUI.css">

    <!-- CodeMirror CSS -->
    <link rel="stylesheet" href="../../../libraries/codemirror/codemirror.min.css">
    <link rel="stylesheet" href="../../../libraries/codemirror/theme/3024-night.css">
    <link rel="stylesheet" href="../../../libraries/codemirror/theme/3024-day.css">
    <link rel="stylesheet" href="../../../libraries/codemirror/theme/dracula.css">
    <link rel="stylesheet" href="../../../libraries/codemirror/addons/show-hint.css">

    <!-- Blocky -->
    <script src="../../../libraries/blockly/blockly.min.js"></script>
</head>
<body>
    <!-- The menu sidebar -->
    <div class="menuSlide">
        <h2 style="color: rgb(194, 104, 247); text-align: center;">MENU</h2>
        <button type="button" onclick="MenuExportButtonClicked()" id="MenuExportButton" style="position: absolute; width: 100%; top: 13%;">Export</button>
        <button type="button" onclick="MenuImportButtonClicked()" id="MenuImportButton" style="position: absolute; width: 100%; top: 20%;">Import</button>
        <button type="button" onclick="QuitButtonClicked()" id="MenuEngineQuitButton" style="position: absolute; width: 100%; top: 27%;">Quit The Engine</button>
    </div>

    <!-- The exporting/importing panel -->
    <div class="ExportingTheGame" style="display: none;">
        <h1>Choose a method</h1>
        <button type="button" id="ExportToPCButton" onclick="ExportToPCButtonClicked()">Export To PC</button>
        <button type="button" id="ExportToHTMLButton" onclick="ExportToHTMLButtonClicked()">Export As HTML</button>
    </div>
    <div class="ImportingTheGame" style="display: none;"></div>

    <div id="layout-1">
        <div class="banner">
            <label for="toggleObjectpanel" class="toggleObject"></label>
            <button type="button" onclick="previewGameClicked()" id="PreviewGameButton">Preview</button>
            <button type="button" onclick="SceneEditorClicked()" id="SceneEditorButton">Scene Editor</button>
            <button type="button" onclick="ScriptEditorClicked()" id="ScriptEditorButton">Script Editor</button>
            <button type="button" onclick="MenuButtonClicked()" id="MenuButton">☰</button>
            <button type="button" onclick="VisualScriptEditorClicked()" id="VisualScriptEditorButton">VS Editor</button>
        </div>
        <input type="checkbox" id="toggleObjectpanel">
        <div class="slide">
            <div class="resizer"></div>
            <h2>Object Panel</h2>
            <button type="button" onclick="NewSpritebuttonclicked()" id="NewSpriteButton">NewSprite</button>
        </div>
        <div class="gameCanvas">
            <!-- Sprites will be added here -->
        </div>
    </div>

    <div id="layout-2" style="display: none;">
        <div class="banner">
            <button type="button" onclick="ScriptEditorClicked()" id="ScriptEditorButton">Script Editor</button>
            <button type="button" onclick="SceneEditorClicked()" id="SceneEditorButton">Scene Editor</button>
            <button type="button" onclick="MenuButtonClicked()" id="MenuButton">☰</button>
            <button type="button" onclick="VisualScriptEditorClicked()" id="VisualScriptEditorButton">VS Editor</button>
        </div>
        <div class="editor">
            <div id="editor" class="editor-container" style="height: 800px;"></div>
        </div>
    </div>

    <div id="layout-3" style="display: none;">
        <div class="banner">
            <button type="button" onclick="ScriptEditorClicked()" id="ScriptEditorButton">Script Editor</button>
            <button type="button" onclick="SceneEditorClicked()" id="SceneEditorButton">Scene Editor</button>
            <button type="button" onclick="MenuButtonClicked()" id="MenuButton">☰</button>
            <button type="button" onclick="VisualScriptEditorClicked()" id="VisualScriptEditorButton">VS Editor</button>
        </div>
        <div id="blocklyDiv"></div>
    </div>

    <input type="file" id="fileInput" style="display: none;" multiple accept="image/png, image/jpeg, image/jpg">

    <!-- CodeMirror JavaScript -->
    <script src="../../../libraries/codemirror/codemirror.min.js"></script>
    <script src="../../../libraries/codemirror/javascript.min.js"></script>

    <!-- CodeMirror Addons -->
    <script src="../../../libraries/codemirror/addons/closebrackets.js"></script>
    <script src="../../../libraries/codemirror/addons/show-hint.js"></script>
    <script src="../../../libraries/codemirror/addons/javascript-hint.js"></script>
    <script src="../../../libraries/codemirror/addons/active-line.js"></script>
    <script src="../../../libraries/codemirror/addons/mark-selection.js"></script>

    <!-- Ensure script files are included in the correct order -->
    <script src="../../JavaScript/Engine/BlocklyEditor.js"></script>
    <script src="../../../libraries/jszip/jszip.min.js"></script>
    <script src="../../JavaScript/Engine/ExportGameLFE.js"></script>
    <script src="../../JavaScript/Engine/ImportGameLFG.js"></script>
    <script src="../../JavaScript/Engine/engineFunction.js"></script>
    <script src="../../JavaScript/Engine/PreviewGame.js"></script>
    <script src="../../JavaScript/Engine/ExportAsHTML.js"></script>
    <script src="../../JavaScript/Engine/EngineButtonClicks.js"></script>

    <script>
        // Initialize CodeMirror editor only when Script Editor is clicked
        let codeMirrorEditor = null;
        let editorInitialized = false;

        function initializeEditor() {
            if (!editorInitialized) {
                codeMirrorEditor = CodeMirror(document.getElementById('editor'), {
                    mode: 'javascript',
                    lineNumbers: true,
                    theme: '3024-night',
                    indentUnit: 4,
                    tabSize: 4,
                    autofocus: true,
                    extraKeys: {"Ctrl-Space": "autocomplete"}, // Autocomplete shortcut
                    autoCloseBrackets: true, // Enable auto-closing of brackets
                    hintOptions: {
                        // Configure hint options if needed (not yet)
                    },
                    styleActiveLine: true,
                    matchBrackets: true
                });

                codeMirrorEditor.getWrapperElement().style.height = '550px'; // Set desired height here

                codeMirrorEditor.setValue(`// Write your JavaScript code here`);
                editorInitialized = true;
            }
        }

        function getEditorCode() {
            if (codeMirrorEditor) {
                return codeMirrorEditor.getValue();
            } else {
                console.error('CodeMirror editor instance is not initialized.');
                return '';
            }
        }
    </script>
</body>
</html>